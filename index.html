<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××©×—×§ ×”××¨×’×œ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { background: rgba(255, 255, 255, 0.95); border-radius: 20px; padding: 40px; max-width: 500px; width: 100%; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        h1 { text-align: center; color: #1a1a2e; margin-bottom: 10px; font-size: 2.5rem; }
        h2 { text-align: center; color: #16213e; margin-bottom: 30px; font-size: 1.5rem; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 1rem; }
        .emoji { font-size: 4rem; text-align: center; margin-bottom: 20px; }
        input[type="text"] { width: 100%; padding: 15px; margin-bottom: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem; transition: border-color 0.3s, box-shadow 0.3s; }
        input[type="text"]:focus { outline: none; border-color: #0f3460; box-shadow: 0 0 10px rgba(15, 52, 96, 0.2); }
        .btn { width: 100%; padding: 15px 30px; border: none; border-radius: 10px; font-size: 1.2rem; cursor: pointer; transition: all 0.3s ease; margin-bottom: 10px; }
        .btn-primary { background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(15, 52, 96, 0.4); }
        .btn-secondary { background: linear-gradient(135deg, #e94560 0%, #c73659 100%); color: white; }
        .btn-secondary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(233, 69, 96, 0.4); }
        .btn-player { background: linear-gradient(135deg, #4a90a4 0%, #2d5f72 100%); color: white; margin-bottom: 15px; }
        .btn-player:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(74, 144, 164, 0.4); }
        .btn-player.revealed { background: #95a5a6; cursor: default; transform: none; }
        .btn-vote { background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%); color: white; padding: 12px 20px; font-size: 1rem; }
        .btn-vote:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(39, 174, 96, 0.4); }
        .btn-vote.selected { background: linear-gradient(135deg, #e94560 0%, #c73659 100%); animation: pulse 1s infinite; }
        .hidden { display: none !important; }
        .role-reveal { text-align: center; padding: 30px; border-radius: 15px; margin-bottom: 20px; }
        .role-reveal.spy { background: linear-gradient(135deg, #e94560 0%, #c73659 100%); color: white; }
        .role-reveal.regular { background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%); color: white; }
        .role-reveal h3 { font-size: 1.8rem; margin-bottom: 15px; }
        .role-reveal p { font-size: 1.2rem; }
        .location-text { font-size: 2rem; font-weight: bold; margin-top: 10px; }
        .turn-indicator { text-align: center; padding: 20px; background: linear-gradient(135deg, #f39c12 0%, #d68910 100%); color: white; border-radius: 15px; margin-bottom: 20px; }
        .turn-indicator h3 { font-size: 1.5rem; }
        .player-list { margin-bottom: 20px; }
        .player-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8f9fa; border-radius: 10px; margin-bottom: 10px; }
        .player-name { font-size: 1.1rem; font-weight: bold; }
        .vote-count { background: #e94560; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; }
        .timer { text-align: center; font-size: 2.5rem; font-weight: bold; color: #1a1a2e; margin-bottom: 20px; }
        .timer.warning { color: #e94560; animation: pulse 0.5s infinite; }
        .result-box { text-align: center; padding: 30px; border-radius: 15px; margin-bottom: 20px; }
        .result-box.win { background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%); color: white; }
        .result-box.lose { background: linear-gradient(135deg, #e94560 0%, #c73659 100%); color: white; }
        .score-board { background: #f8f9fa; border-radius: 15px; padding: 20px; margin-bottom: 20px; }
        .score-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
        .score-item:last-child { border-bottom: none; }
        .difficulty-selector { display: flex; gap: 10px; margin-bottom: 20px; }
        .difficulty-btn { flex: 1; padding: 10px; border: 2px solid #e0e0e0; border-radius: 10px; background: white; cursor: pointer; transition: all 0.3s; }
        .difficulty-btn.active { border-color: #0f3460; background: #0f3460; color: white; }
        .custom-location-input { display: flex; gap: 10px; margin-bottom: 20px; }
        .custom-location-input input { flex: 1; margin-bottom: 0; }
        .custom-location-input button { width: auto; padding: 15px 20px; }
        .locations-list { max-height: 150px; overflow-y: auto; background: #f8f9fa; border-radius: 10px; padding: 15px; margin-bottom: 20px; }
        .location-tag { display: inline-block; background: #0f3460; color: white; padding: 5px 12px; border-radius: 20px; margin: 3px; font-size: 0.85rem; }
        .location-tag.custom { background: #27ae60; }
        .instructions { background: #fff3cd; border: 1px solid #ffc107; border-radius: 10px; padding: 15px; margin-bottom: 20px; font-size: 0.9rem; color: #856404; }
        @media (max-width: 480px) { .container { padding: 25px; } h1 { font-size: 2rem; } .emoji { font-size: 3rem; } }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div id="welcome-screen">
            <div class="emoji">ğŸ•µï¸</div>
            <h1>××©×—×§ ×”××¨×’×œ</h1>
            <p class="subtitle">××¦××• ××ª ×”××¨×’×œ ×œ×¤× ×™ ×©×”×•× ××’×œ×” ××ª ×”××§×•×!</p>
            <div class="instructions"><strong>××™×š ××©×—×§×™×?</strong><br>â€¢ ××™× ×™××•× 3 ×©×—×§× ×™× - ××—×“ ××”× ××¨×’×œ<br>â€¢ ×›×œ ×”×©×—×§× ×™× ×—×•×¥ ××”××¨×’×œ ×™×•×“×¢×™× ××ª ×”××§×•×<br>â€¢ ×”××¨×’×œ ×œ× ×™×•×“×¢ ××ª ×”××§×•×<br>â€¢ ×©×•××œ×™× ×©××œ×•×ª ×‘×ª×•×¨×•×ª ×›×“×™ ×œ×’×œ×•×ª ××™ ×”××¨×’×œ!</div>
            <button class="btn btn-primary" onclick="showPlayerInput()">×”×ª×—×œ ××©×—×§ ×—×“×©</button>
        </div>
        <div id="player-input-screen" class="hidden">
            <h2>×”×–×™× ×• ××ª ×©××•×ª ×”×©×—×§× ×™×</h2>
            <p class="subtitle">××™× ×™××•× 3 ×©×—×§× ×™×</p>
            <div id="player-inputs">
                <input type="text" class="player-input" placeholder="×©×—×§×Ÿ 1">
                <input type="text" class="player-input" placeholder="×©×—×§×Ÿ 2">
                <input type="text" class="player-input" placeholder="×©×—×§×Ÿ 3">
            </div>
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="btn btn-vote" onclick="addPlayerInput()">+ ×”×•×¡×£ ×©×—×§×Ÿ</button>
                <button class="btn btn-vote" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);" onclick="removePlayerInput()">- ×”×¡×¨ ×©×—×§×Ÿ</button>
            </div>
            <h3 style="margin: 20px 0 10px;">×‘×—×¨×• ×¨××ª ×§×•×©×™:</h3>
            <div class="difficulty-selector">
                <button class="difficulty-btn active" onclick="setDifficulty('easy', this)">×§×œ</button>
                <button class="difficulty-btn" onclick="setDifficulty('medium', this)">×‘×™× ×•× ×™</button>
                <button class="difficulty-btn" onclick="setDifficulty('hard', this)">×§×©×”</button>
            </div>
            <h3 style="margin: 20px 0 10px;">×”×•×¡×™×¤×• ××§×•× ××•×ª×× ××™×©×™×ª:</h3>
            <div class="custom-location-input">
                <input type="text" id="custom-location" placeholder="×©× ×”××§×•×">
                <button class="btn btn-vote" onclick="addCustomLocation()">×”×•×¡×£</button>
            </div>
            <div class="locations-list" id="locations-preview"></div>
            <button class="btn btn-primary" onclick="startGame()">×”×ª×—×œ ××©×—×§</button>
        </div>
        <div id="role-reveal-screen" class="hidden">
            <h2>×—×©×™×¤×ª ×ª×¤×§×™×“×™×</h2>
            <p class="subtitle">×›×œ ×©×—×§×Ÿ ×œ×•×—×¥ ×¢×œ ×©××• ×›×“×™ ×œ×¨××•×ª ××ª ×”×ª×¤×§×™×“ ×©×œ×•</p>
            <div id="player-buttons"></div>
            <button class="btn btn-secondary hidden" id="start-game-btn" onclick="showGameScreen()">×›×•×œ× ×¨××•? ××ª×—×™×œ×™×!</button>
        </div>
        <div id="role-display-screen" class="hidden">
            <div id="role-content"></div>
            <button class="btn btn-primary" onclick="hideRole()">×”×‘× ×ª×™, ×”×¡×ª×¨</button>
        </div>
        <div id="game-screen" class="hidden">
            <h2>×©×œ×‘ ×”×©××œ×•×ª</h2>
            <div class="timer" id="timer">02:00</div>
            <div class="turn-indicator">
                <h3>×”×ª×•×¨ ×©×œ: <span id="current-player"></span></h3>
                <p>×©××œ ×©××œ×” ×œ××—×“ ×”×©×—×§× ×™×!</p>
            </div>
            <button class="btn btn-primary" onclick="nextTurn()">×”×©×—×§×Ÿ ×”×‘×</button>
            <button class="btn btn-secondary" onclick="startVoting()">×¢×‘×•×¨ ×œ×”×¦×‘×¢×”</button>
        </div>
        <div id="voting-screen" class="hidden">
            <h2>×”×¦×‘×¢×”</h2>
            <p class="subtitle">××™ ×œ×“×¢×ª×›× ×”××¨×’×œ?</p>
            <div id="voting-buttons"></div>
            <button class="btn btn-secondary" onclick="submitVotes()">×¡×™×™× ×”×¦×‘×¢×” ×•×—×©×•×£</button>
        </div>
        <div id="results-screen" class="hidden">
            <div id="results-content"></div>
            <div class="score-board">
                <h3 style="text-align: center; margin-bottom: 15px;">×˜×‘×œ×ª × ×™×§×•×“</h3>
                <div id="score-board"></div>
            </div>
            <button class="btn btn-primary" onclick="playAgain()">××©×—×§ ×—×“×© (××•×ª× ×©×—×§× ×™×)</button>
            <button class="btn btn-secondary" onclick="resetGame()">×”×ª×—×œ ××—×“×©</button>
        </div>
    </div>
    <script>
        let players = [];
        let spyIndex = -1;
        let currentLocation = '';
        let currentTurn = 0;
        let votes = {};
        let scores = {};
        let timerInterval = null;
        let timeLeft = 120;
        let difficulty = 'easy';
        let revealedPlayers = [];
        function getSecureRandom(max) {
            if (window.crypto && window.crypto.getRandomValues) {
                const array = new Uint32Array(1);
                window.crypto.getRandomValues(array);
                return array[0] % max;
            }
            return Math.floor(Math.random() * max);
        }
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = getSecureRandom(i + 1);
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        const locations = {
            easy: ['×—×•×£ ×”×™×', '×‘×™×ª ×¡×¤×¨', '×‘×™×ª ×—×•×œ×™×', '××¡×¢×“×”', '×§× ×™×•×Ÿ', '×’×Ÿ ×—×™×•×ª', '×ª×—× ×ª ×“×œ×§', '×‘× ×§', '×¡×¤×¨×™×™×”', '×—×“×¨ ×›×•×©×¨', '×¤××¨×§', '×§×•×œ× ×•×¢', '×¡×•×¤×¨××¨×§×˜', '×ª×—× ×ª ×¨×›×‘×ª', '×©×“×” ×ª×¢×•×¤×”'],
            medium: ['××•×–×™××•×Ÿ', '××•×œ× ×§×•× ×¦×¨×˜×™×', '×‘×™×ª ××©×¤×˜', '×ª×—× ×ª ××©×˜×¨×”', '××›×‘×¡×”', '××¡×¤×¨×”', '×—× ×•×ª ×¡×¤×¨×™×', '×‘×™×ª ×§×¤×”', '××œ×•×Ÿ', '××•× ×™×‘×¨×¡×™×˜×”', '××’×¨×© ×›×“×•×¨×’×œ', '×‘×¨×™×›×ª ×©×—×™×™×”', '××•×¢×“×•×Ÿ ×œ×™×œ×”', '×—× ×•×ª ×‘×’×“×™×', '××¨×¤××”'],
            hard: ['×¦×•×œ×œ×ª', '×ª×—× ×ª ×—×œ×œ', '×§×–×™× ×•', '××•×¤×¨×”', '×©×’×¨×™×¨×•×ª', '×× ×–×¨', '×‘×™×ª ×§×‘×¨×•×ª', '××—×¡×Ÿ × ×©×§', '×¡×˜×•×“×™×• ×œ×¦×™×œ×•×', '××ª×§×Ÿ ×’×¨×¢×™× ×™', '×¡×¤×™× ×ª ×§×¨×•×–', '×§×¨×§×¡', '×‘×™×ª ××¨×§×—×ª', '× ××œ', '××¤×¢×œ'],
            custom: []
        };
        function init() { updateLocationsPreview(); updatePlayerInputNumbers(); }
        function addPlayerInput() {
            const container = document.getElementById('player-inputs');
            const currentCount = container.querySelectorAll('.player-input').length;
            const newInput = document.createElement('input');
            newInput.type = 'text';
            newInput.className = 'player-input';
            newInput.placeholder = `×©×—×§×Ÿ ${currentCount + 1}`;
            container.appendChild(newInput);
        }
        function removePlayerInput() {
            const container = document.getElementById('player-inputs');
            const inputs = container.querySelectorAll('.player-input');
            if (inputs.length > 3) container.removeChild(inputs[inputs.length - 1]);
        }
        function updatePlayerInputNumbers() {
            const inputs = document.querySelectorAll('#player-inputs .player-input');
            inputs.forEach((input, index) => { input.placeholder = `×©×—×§×Ÿ ${index + 1}`; });
        }
        function setDifficulty(level, btn) {
            difficulty = level;
            document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            updateLocationsPreview();
        }
        function addCustomLocation() {
            const input = document.getElementById('custom-location');
            const location = input.value.trim();
            if (location && !locations.custom.includes(location)) {
                locations.custom.push(location);
                input.value = '';
                updateLocationsPreview();
            }
        }
        function updateLocationsPreview() {
            const preview = document.getElementById('locations-preview');
            let allLocations = [...locations[difficulty], ...locations.custom];
            preview.innerHTML = allLocations.map((loc, i) => `<span class="location-tag ${i >= locations[difficulty].length ? 'custom' : ''}">${loc}</span>`).join('');
        }
        function showPlayerInput() {
            hideAllScreens();
            document.getElementById('player-input-screen').classList.remove('hidden');
        }
        function startGame() {
            players = [];
            const inputs = document.querySelectorAll('#player-inputs .player-input');
            inputs.forEach((input, index) => {
                const name = input.value.trim() || `×©×—×§×Ÿ ${index + 1}`;
                players.push(name);
                if (!scores[name]) scores[name] = 0;
            });
            if (players.length < 3) { alert('× ×“×¨×©×™× ×œ×¤×—×•×ª 3 ×©×—×§× ×™×!'); return; }
            spyIndex = getSecureRandom(players.length);
            const availableLocations = [...locations[difficulty], ...locations.custom];
            currentLocation = availableLocations[getSecureRandom(availableLocations.length)];
            currentTurn = 0; votes = {}; revealedPlayers = [];
            players.forEach(p => votes[p] = 0);
            showRoleReveal();
        }
        function showRoleReveal() {
            hideAllScreens();
            document.getElementById('role-reveal-screen').classList.remove('hidden');
            const playerIndices = players.map((_, index) => index);
            const shuffledIndices = shuffleArray(playerIndices);
            const buttonsContainer = document.getElementById('player-buttons');
            buttonsContainer.innerHTML = shuffledIndices.map(index => `<button class="btn btn-player" id="reveal-btn-${index}" onclick="revealRole(${index})">${players[index]}</button>`).join('');
            document.getElementById('start-game-btn').classList.add('hidden');
        }
        function revealRole(index) {
            if (revealedPlayers.includes(index)) return;
            hideAllScreens();
            document.getElementById('role-display-screen').classList.remove('hidden');
            const content = document.getElementById('role-content');
            const isSpy = index === spyIndex;
            if (isSpy) {
                content.innerHTML = `<div class="role-reveal spy"><h3>ğŸ•µï¸ ${players[index]}</h3><p>××ª×” ×”××¨×’×œ!</p><p class="location-text">× ×¡×” ×œ×’×œ×•×ª ××ª ×”××§×•×</p></div>`;
            } else {
                content.innerHTML = `<div class="role-reveal regular"><h3>ğŸ‘¤ ${players[index]}</h3><p>×”××§×•× ×”×•×:</p><p class="location-text">${currentLocation}</p></div>`;
            }
            revealedPlayers.push(index);
        }
        function hideRole() {
            hideAllScreens();
            document.getElementById('role-reveal-screen').classList.remove('hidden');
            revealedPlayers.forEach(index => {
                const btn = document.getElementById(`reveal-btn-${index}`);
                btn.classList.add('revealed');
                btn.innerHTML = `${players[index]} âœ“`;
            });
            if (revealedPlayers.length === players.length) document.getElementById('start-game-btn').classList.remove('hidden');
        }
        function showGameScreen() {
            hideAllScreens();
            document.getElementById('game-screen').classList.remove('hidden');
            currentTurn = 0;
            updateCurrentPlayer();
            startTimer();
        }
        function updateCurrentPlayer() { document.getElementById('current-player').textContent = players[currentTurn]; }
        function nextTurn() { currentTurn = (currentTurn + 1) % players.length; updateCurrentPlayer(); }
        function startTimer() {
            timeLeft = 120;
            updateTimerDisplay();
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) { clearInterval(timerInterval); startVoting(); }
            }, 1000);
        }
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const display = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            const timerEl = document.getElementById('timer');
            timerEl.textContent = display;
            if (timeLeft <= 30) timerEl.classList.add('warning');
            else timerEl.classList.remove('warning');
        }
        function startVoting() {
            if (timerInterval) clearInterval(timerInterval);
            hideAllScreens();
            document.getElementById('voting-screen').classList.remove('hidden');
            const buttonsContainer = document.getElementById('voting-buttons');
            buttonsContainer.innerHTML = players.map((player, index) => `<div class="player-item"><span class="player-name">${player}</span><button class="btn btn-vote" onclick="toggleVote(${index}, this)">${votes[player]} ×”×¦×‘×¢×•×ª</button></div>`).join('');
        }
        function toggleVote(index, btn) {
            const player = players[index];
            votes[player]++;
            btn.textContent = `${votes[player]} ×”×¦×‘×¢×•×ª`;
            btn.classList.add('selected');
            setTimeout(() => btn.classList.remove('selected'), 300);
        }
        function submitVotes() {
            hideAllScreens();
            document.getElementById('results-screen').classList.remove('hidden');
            let maxVotes = 0; let accusedPlayer = '';
            players.forEach(player => { if (votes[player] > maxVotes) { maxVotes = votes[player]; accusedPlayer = player; } });
            const spyName = players[spyIndex];
            const spyCaught = accusedPlayer === spyName;
            if (spyCaught) players.forEach((player, index) => { if (index !== spyIndex) scores[player] += 1; });
            else scores[spyName] += 2;
            const content = document.getElementById('results-content');
            content.innerHTML = `<div class="result-box ${spyCaught ? 'win' : 'lose'}"><div class="emoji">${spyCaught ? 'ğŸ‰' : 'ğŸ˜ˆ'}</div><h3>${spyCaught ? '×”××¨×’×œ × ×ª×¤×¡!' : '×”××¨×’×œ × ×™×¦×—!'}</h3><p>×”××¨×’×œ ×”×™×”: <strong>${spyName}</strong></p><p>×”××§×•× ×”×™×”: <strong>${currentLocation}</strong></p>${!spyCaught ? `<p>×”×•××©×: <strong>${accusedPlayer}</strong></p>` : ''}</div>`;
            const scoreBoard = document.getElementById('score-board');
            scoreBoard.innerHTML = players.map(player => `<div class="score-item"><span>${player} ${player === spyName ? 'ğŸ•µï¸' : ''}</span><span>${scores[player]} × ×§×•×“×•×ª</span></div>`).join('');
        }
        function playAgain() {
            spyIndex = getSecureRandom(players.length);
            const availableLocations = [...locations[difficulty], ...locations.custom];
            currentLocation = availableLocations[getSecureRandom(availableLocations.length)];
            currentTurn = 0; votes = {}; revealedPlayers = [];
            players.forEach(p => votes[p] = 0);
            showRoleReveal();
        }
        function resetGame() {
            players = []; spyIndex = -1; currentLocation = ''; currentTurn = 0; votes = {}; scores = {}; revealedPlayers = [];
            if (timerInterval) clearInterval(timerInterval);
            hideAllScreens();
            document.getElementById('welcome-screen').classList.remove('hidden');
        }
        function hideAllScreens() { document.querySelectorAll('#app > div').forEach(screen => screen.classList.add('hidden')); }
        init();
    </script>
</body>
</html>
